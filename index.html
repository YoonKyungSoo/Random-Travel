<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëœë¤ ì—¬í–‰ì§€ í”½! ğŸ—ºï¸âœˆï¸</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
     <!-- ì¹´ì¹´ì˜¤ë§µ API ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c837a316c42b3e191934f21e1921839f"></script>
    
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸ—ºï¸ ëœë¤ ì—¬í–‰ì§€ í”½!</h1>
            <p>í•œêµ­ ì§€ë„ì—ì„œ ìš´ëª…ì˜ ì—¬í–‰ì§€ë¥¼ ì°¾ì•„ë³´ì„¸ìš”!</p>
        </header>

        <div class="main-content">
            <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
            <div class="map-container">
          <div id="map" style="width:100%;height:400px;"></div>
            </div>

            <!-- ê¸°ë³¸ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ë“¤ -->
            <div class="controls">
                <div class="desktop-controls">
                    <button id="randomPickBtn" class="btn primary">ğŸ¯ ëœë¤ ì—¬í–‰ì§€ í”½!</button>
                    <button id="resetBtn" class="btn secondary">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
                    <button id="favoriteBtn" class="btn accent hidden">â¤ï¸ ì¦ê²¨ì°¾ê¸°</button>
                </div>
                <div class="mobile-controls">
                    <button id="randomPickBtnMobile" class="btn primary">ğŸ¯ ëœë¤í”½!</button>
                    <button id="favoriteBtnMobile" class="btn accent">â¤ï¸ ì¦ê²¨ì°¾ê¸°</button>
                    <button id="favoritesListBtnMobile" class="btn secondary">ğŸ“‹ ì°œ ë¦¬ìŠ¤íŠ¸</button>
                </div>
            </div>

            <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
            <div id="resultCard" class="result-card hidden">
                <h3>ğŸ‰ ì—¬í–‰ì§€ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
                <div id="locationInfo">
                    <p id="locationName"></p>
                    <p id="locationDescription"></p>
                </div>
                <div class="action-buttons">
                    <button id="shareBtn" class="btn small">ğŸ“¤ ê³µìœ í•˜ê¸°</button>
                </div>
            </div>

                    <!-- ì¦ê²¨ì°¾ê¸° ëª©ë¡ ì˜ì—­ -->
        <div id="favoritesSection" class="favorites-section">
            <h3>â¤ï¸ ì¦ê²¨ì°¾ê¸°í•œ ì—¬í–‰ì§€</h3>
            <div id="favoritesContainer"></div>
        </div>
        
        <!-- ì¦ê²¨ì°¾ê¸° íŒì—… -->
        <div id="favoritesPopup" class="favorites-popup">
            <div class="popup-content">
                <div class="popup-header">
                    <h3>â¤ï¸ ì¦ê²¨ì°¾ê¸°í•œ ì—¬í–‰ì§€</h3>
                    <button id="closePopupBtn" class="close-btn">Ã—</button>
                </div>
                <div class="popup-body">
                    <div id="popupFavoritesContainer"></div>
                </div>
            </div>
        </div>
        </div>
    </div>
    
   
    <!-- ì§€ì—­ ë°ì´í„° íŒŒì¼ë“¤ -->
    <script src="locations/seoul-locations.js"></script>
    <script src="locations/busan-locations.js"></script>
    <script src="locations/daegu-locations.js"></script>
    <script src="locations/incheon-locations.js"></script>
    <script src="locations/gwangju-locations.js"></script>
    <script src="locations/daejeon-locations.js"></script>
    <script src="locations/ulsan-locations.js"></script>
    <script src="locations/sejong-locations.js"></script>
    <script src="locations/gyeonggi-locations.js"></script>
    <script src="locations/gangwon-locations.js"></script>
    <script src="locations/chungbuk-locations.js"></script>
    <script src="locations/chungnam-locations.js"></script>
    <script src="locations/jeonbuk-locations.js"></script>
    <script src="locations/jeonnam-locations.js"></script>
    <script src="locations/gyeongbuk-locations.js"></script>
    <script src="locations/gyeongnam-locations.js"></script>
    <script src="locations/jeju-locations.js"></script>
    
    <!-- ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ëŠ¥ -->
    <script src="script.js"></script>
    <script>
        var tempMarker = null;
        var routeMap1 = null;
        var routeMap2 = null;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì§€ë„ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            // ì¹´ì¹´ì˜¤ë§µ API ë¡œë”© í™•ì¸ ë° ì´ˆê¸°í™”
            checkKakaoMapAPI();
            
            // ì €ì¥ëœ ì¦ê²¨ì°¾ê¸° ë¶ˆëŸ¬ì˜¤ê¸°
            loadFavorites();
        });
        
        // ì¹´ì¹´ì˜¤ë§µ API ë¡œë”© í™•ì¸
        function checkKakaoMapAPI() {
            if (typeof kakao !== 'undefined' && kakao.maps) {
                console.log('âœ… ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì™„ë£Œ!');
                initializeMap();
            } else {
                console.log('ì¹´ì¹´ì˜¤ë§µ API ë¡œë”© ëŒ€ê¸° ì¤‘...');
                // 500msë§ˆë‹¤ ì¬ì‹œë„ (ìµœëŒ€ 10ì´ˆ)
                if (window.kakaoRetryCount === undefined) {
                    window.kakaoRetryCount = 0;
                }
                
                if (window.kakaoRetryCount < 20) { // 10ì´ˆ ëŒ€ê¸°
                    window.kakaoRetryCount++;
                    setTimeout(checkKakaoMapAPI, 500);
                } else {
                    console.error('ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ ì‹¤íŒ¨');
                    showMapError();
                }
            }
        }
        
        // ì§€ë„ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ í‘œì‹œ
        function showMapError() {
            const mapContainer = document.getElementById('map');
            if (mapContainer) {
                mapContainer.innerHTML = `
                    <div style="
                        width: 100%; 
                        height: 100%; 
                        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
                        display: flex; 
                        align-items: center; 
                        justify-content: center;
                        border-radius: 15px;
                        color: white;
                        font-size: 1.2rem;
                        text-align: center;
                        cursor: pointer;
                    " onclick="retryKakaoMap()">
                        <div>
                            <div style="font-size: 3rem; margin-bottom: 15px;">âš ï¸</div>
                            <div style="font-size: 1.4rem; font-weight: bold; margin-bottom: 10px;">ì§€ë„ ë¡œë“œ ì‹¤íŒ¨</div>
                            <div style="font-size: 1rem; margin-bottom: 20px; opacity: 0.9;">ì¹´ì¹´ì˜¤ë§µ API ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</div>
                            <div style="
                                background: rgba(255,255,255,0.2);
                                padding: 10px 20px;
                                border-radius: 20px;
                                font-size: 0.9rem;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                border: 1px solid rgba(255,255,255,0.3);
                            " onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
                               onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                                í´ë¦­í•˜ì—¬ ë‹¤ì‹œ ì‹œë„
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        // ì¹´ì¹´ì˜¤ë§µ ì¬ì‹œë„
        function retryKakaoMap() {
            window.kakaoRetryCount = 0;
            checkKakaoMapAPI();
        }
        
        // ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™”
        function initializeMap() {
            try {
                // script.jsì˜ initializeMap í•¨ìˆ˜ í˜¸ì¶œ
                if (typeof window.initializeMap === 'function') {
                    window.initializeMap();
                    console.log('âœ… ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™” ì™„ë£Œ!');
                } else {
                    console.error('script.jsì˜ initializeMap í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì§€ë„ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì¬ì‹œë„
                setTimeout(initializeMap, 1000);
            }
        }
        

        
        // ëœë¤ ì—¬í–‰ì§€ ì„ íƒ
        function pickRandomLocation() {
            if (!window.map) {
                alert('ì§€ë„ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                // script.jsì˜ pickRandomLocation í•¨ìˆ˜ ì‚¬ìš©
                if (typeof window.pickRandomLocation === 'function') {
                    window.pickRandomLocation();
                } else {
                    alert('ëœë¤ ì—¬í–‰ì§€ ì„ íƒ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ëœë¤ ì—¬í–‰ì§€ ì„ íƒ ì˜¤ë¥˜:', error);
                alert('ì—¬í–‰ì§€ ì„ íƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê²°ê³¼ í‘œì‹œ
        function showResult(locationName, locationDescription = null) {
            document.getElementById('locationName').textContent = locationName;
            if (locationDescription) {
                document.getElementById('locationDescription').textContent = locationDescription;
            } else {
                document.getElementById('locationDescription').textContent = `${locationName}ì—ì„œ ë©‹ì§„ ì—¬í–‰ì„ ì¦ê²¨ë³´ì„¸ìš”!`;
            }
            document.getElementById('resultCard').classList.remove('hidden');
            document.getElementById('favoriteBtn').classList.remove('hidden');
        }
        
        // ì¦ê²¨ì°¾ê¸° ì¶”ê°€
        function addToFavorites(location = null) {
            try {
                // script.jsì˜ addToFavorites í•¨ìˆ˜ ì‚¬ìš©
                if (typeof window.addToFavorites === 'function' && location) {
                    window.addToFavorites(location);
                } else {
                    alert('ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì¦ê²¨ì°¾ê¸° ì¶”ê°€ ì˜¤ë¥˜:', error);
                alert('ì¦ê²¨ì°¾ê¸° ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì¦ê²¨ì°¾ê¸° ë¡œë“œ
        function loadFavorites() {
            try {
                // script.jsì˜ updateFavoritesList í•¨ìˆ˜ ì‚¬ìš©
                if (typeof window.updateFavoritesList === 'function') {
                    window.updateFavoritesList();
                } else {
                    // fallback: ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì§ì ‘ ë¡œë“œ
                    const favorites = JSON.parse(localStorage.getItem('travelFavorites') || '[]');
                    const container = document.getElementById('favoritesContainer');
                    
                    if (favorites.length === 0) {
                        container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9;">ì•„ì§ ì¦ê²¨ì°¾ê¸°í•œ ì—¬í–‰ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ëœë¤ ì—¬í–‰ì§€ë¥¼ ì„ íƒí•˜ê³  â¤ï¸ ì¦ê²¨ì°¾ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!</p>';
                        return;
                    }
                    
                    container.innerHTML = favorites.map(fav => `
                        <div class="favorite-item" style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 10px; background: #f9f9f9;">
                            <h5 style="margin: 0 0 10px 0; color: #333;">${fav.name}</h5>
                            ${fav.description ? `<p style="margin: 5px 0; color: #666; font-size: 14px;">${fav.description}</p>` : ''}
                            <p style="margin: 5px 0; color: #888; font-size: 12px;">ì¶”ê°€ëœ ë‚ ì§œ: ${new Date(fav.timestamp).toLocaleDateString('ko-KR')}</p>
                            <button onclick="removeFavorite(${fav.id})" class="btn small" style="background: #ff6b6b; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">ì‚­ì œ</button>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('ì¦ê²¨ì°¾ê¸° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ì¦ê²¨ì°¾ê¸° ì‚­ì œ
        function removeFavorite(id) {
            try {
                // script.jsì˜ removeFavoriteById í•¨ìˆ˜ ì‚¬ìš©
                if (typeof window.removeFavoriteById === 'function') {
                    window.removeFavoriteById(id);
                } else {
                    alert('ì¦ê²¨ì°¾ê¸° ì‚­ì œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì¦ê²¨ì°¾ê¸° ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì¦ê²¨ì°¾ê¸° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        

        
        // ë‹¤ì‹œí•˜ê¸°
        function reset() {
            try {
                // script.jsì˜ resetMap í•¨ìˆ˜ ì‚¬ìš©
                if (typeof window.resetMap === 'function') {
                    window.resetMap();
                } else {
                    // fallback: ê¸°ë³¸ ë¦¬ì…‹ ê¸°ëŠ¥
                    if (tempMarker && window.map) {
                        tempMarker.setMap(null);
                        tempMarker = null;
                    }
                    
                    document.getElementById('resultCard').classList.add('hidden');
                    document.getElementById('favoriteBtn').classList.add('hidden');
                    
                    if (window.map) {
                        window.map.setCenter(new kakao.maps.LatLng(36.5, 127.5));
                        window.map.setLevel(7);
                    }
                }
            } catch (error) {
                console.error('ë¦¬ì…‹ ì˜¤ë¥˜:', error);
            }
        }
        
        // ê²½ë¡œ ê·¸ë¦¬ê¸° ê´€ë ¨ í•¨ìˆ˜ë“¤ (ì¹´ì¹´ì˜¤ë§µ APIë¡œ êµ¬í˜„)
        function jsCreatRoute(mapName) {
            if (!map) return;
            
            // ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì‚¬ìš©í•œ ê²½ë¡œ ìƒì„±
            console.log(`${mapName} ê²½ë¡œ ìƒì„± ì¤€ë¹„`);
            
            if (mapName == 'test1') {
                routeMap1 = {
                    name: mapName,
                    polyline: null,
                    points: []
                };
            } else {
                routeMap2 = {
                    name: mapName,
                    polyline: null,
                    points: []
                };
            }
        }
        
        function jsAddRouteEvent(mapName) {
            if (!map) return;
            
            // ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì‚¬ìš©í•œ ê²½ë¡œ ì´ë²¤íŠ¸ ì¶”ê°€
            console.log(`${mapName} ê²½ë¡œ ì´ë²¤íŠ¸ ì¶”ê°€`);
            
            // ì§€ë„ í´ë¦­ ì‹œ ê²½ë¡œì— ì  ì¶”ê°€
            if (mapName == 'test1' && routeMap1) {
                routeMap1.isActive = true;
            } else if (mapName == 'test2' && routeMap2) {
                routeMap2.isActive = true;
            }
        }
        
        function mClick1(event) {
            if (!routeMap1 || !routeMap1.isActive) return;
            
            // ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì‚¬ìš©í•œ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
            console.log('test1 í´ë¦­ ì´ë²¤íŠ¸');
            
            // í´ë¦­í•œ ìœ„ì¹˜ë¥¼ ê²½ë¡œì— ì¶”ê°€
            const latlng = event.latLng;
            routeMap1.points.push(latlng);
            
            // ê²½ë¡œ ê·¸ë¦¬ê¸°
            drawRoute('test1');
        }
        
        function mClick2(event) {
            if (!routeMap2 || !routeMap2.isActive) return;
            
            // ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì‚¬ìš©í•œ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
            console.log('test2 í´ë¦­ ì´ë²¤íŠ¸');
            
            // í´ë¦­í•œ ìœ„ì¹˜ë¥¼ ê²½ë¡œì— ì¶”ê°€
            const latlng = event.latLng;
            routeMap2.points.push(latlng);
            
            // ê²½ë¡œ ê·¸ë¦¬ê¸°
            drawRoute('test2');
        }
        
        // ê²½ë¡œ ê·¸ë¦¬ê¸° í•¨ìˆ˜
        function drawRoute(mapName) {
            let routeData;
            if (mapName == 'test1') {
                routeData = routeMap1;
            } else {
                routeData = routeMap2;
            }
            
            if (!routeData || routeData.points.length < 2) return;
            
            // ê¸°ì¡´ ê²½ë¡œ ì œê±°
            if (routeData.polyline) {
                routeData.polyline.setMap(null);
            }
            
            // ìƒˆ ê²½ë¡œ ìƒì„±
            routeData.polyline = new kakao.maps.Polyline({
                path: routeData.points,
                strokeWeight: 3,
                strokeColor: '#FF0000',
                strokeOpacity: 0.7,
                strokeStyle: 'solid'
            });
            
            routeData.polyline.setMap(map);
        }
        
        function jsInit(mapName) {
            if (!map) return;
            
            // ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì‚¬ìš©í•œ ê²½ë¡œ ì´ˆê¸°í™”
            console.log(`${mapName} ê²½ë¡œ ì´ˆê¸°í™”`);
            
            if (mapName == 'test1' && routeMap1) {
                routeMap1.isActive = false;
            } else if (mapName == 'test2' && routeMap2) {
                routeMap2.isActive = false;
            }
        }
        
        function setColor(mapName) {
            if (!map) return;
            
            // ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì‚¬ìš©í•œ ìƒ‰ìƒ ì„¤ì •
            console.log(`${mapName} ìƒ‰ìƒ ë³€ê²½`);
            
            let routeData;
            if (mapName == 'test1') {
                routeData = routeMap1;
            } else {
                routeData = routeMap2;
            }
            
            if (routeData && routeData.polyline) {
                routeData.polyline.setOptions({
                    strokeColor: '#990033'
                });
            }
        }
        
        function setWidth(mapName) {
            if (!map) return;
            
            // ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì‚¬ìš©í•œ ë„ˆë¹„ ì„¤ì •
            console.log(`${mapName} ë„ˆë¹„ ë³€ê²½`);
            
            let routeData;
            if (mapName == 'test1') {
                routeData = routeMap1;
            } else {
                routeData = routeMap2;
            }
            
            if (routeData && routeData.polyline) {
                routeData.polyline.setOptions({
                    strokeWeight: 20
                });
            }
        }
        
        function jsRemoveRoute(mapName) {
            if (!map) return;
            
            // ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì‚¬ìš©í•œ ê²½ë¡œ ì œê±°
            console.log(`${mapName} ê²½ë¡œ ì œê±°`);
            
            if (mapName == 'test1' && routeMap1) {
                if (routeMap1.polyline) {
                    routeMap1.polyline.setMap(null);
                }
                routeMap1 = null;
            } else if (mapName == 'test2' && routeMap2) {
                if (routeMap2.polyline) {
                    routeMap2.polyline.setMap(null);
                }
                routeMap2 = null;
            }
        }
        
        function closeAllPop(mapName) {
            if (!map) return;
            
            // ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì‚¬ìš©í•œ íŒì—… ë‹«ê¸°
            console.log(`${mapName} íŒì—… ë‹«ê¸°`);
            
            // ëª¨ë“  ì •ë³´ì°½ ë‹«ê¸°
            const infowindows = document.querySelectorAll('.kakao-map-info-window');
            infowindows.forEach(window => window.style.display = 'none');
        }
        
        function openAllPop(mapName) {
            if (!map) return;
            
            // ì¹´ì¹´ì˜¤ë§µ APIë¥¼ ì‚¬ìš©í•œ íŒì—… ì—´ê¸°
            console.log(`${mapName} íŒì—… ì—´ê¸°`);
            
            // ëª¨ë“  ì •ë³´ì°½ ì—´ê¸°
            const infowindows = document.querySelectorAll('.kakao-map-info-window');
            infowindows.forEach(window => window.style.display = 'block');
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('randomPickBtn').addEventListener('click', pickRandomLocation);
            document.getElementById('resetBtn').addEventListener('click', reset);
            document.getElementById('favoriteBtn').addEventListener('click', addToFavorites);
        });
    </script>
</body>

</html>